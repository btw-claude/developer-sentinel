{# Security audit complete - all external links have rel="noopener noreferrer" #}
{% from "macros.html" import success_rate_display %}
{% if state.completed_executions %}
<table>
    <tr>
        <th>Issue Key</th>
        <th>Orchestration</th>
        <th>Status</th>
        <th>Duration</th>
        <th>Tokens</th>
        <th>Cost</th>
        <th>Completed</th>
    </tr>
    {% for exec in state.completed_executions %}
    <tr>
        <td>
            {% if exec.issue_url %}
            <a href="{{ exec.issue_url }}" target="_blank" rel="noopener noreferrer">
                <strong>{{ exec.issue_key }}</strong>
            </a>
            {% else %}
            <strong>{{ exec.issue_key }}</strong>
            {% endif %}
        </td>
        <td>{{ exec.orchestration_name }}</td>
        <td>
            {% if exec.status == "success" %}
            <span class="status-badge status-success">Success</span>
            {% else %}
            <span class="status-badge status-failure">Failure</span>
            {% endif %}
        </td>
        <td>{{ exec.duration_seconds | format_duration }}</td>
        <td>
            <span title="Input tokens">{{ "{:,}".format(exec.input_tokens) }}</span><span class="text-muted">&darr;</span>
            /
            <span title="Output tokens">{{ "{:,}".format(exec.output_tokens) }}</span><span class="text-muted">&uarr;</span>
        </td>
        <td>
            ${{ "%.4f" | format(exec.total_cost_usd) }}
        </td>
        <td>
            {{ exec.completed_at.strftime('%b %d %H:%M:%S') }}
        </td>
    </tr>
    {% endfor %}
    <tfoot>
    <tr class="summary-row">
        <td colspan="2"><strong>Summary</strong> ({{ state.execution_summary.total_executions }} executions)</td>
        <td>
            <span class="status-badge status-success">{{ state.execution_summary.success_count }}</span>
            <span class="status-badge status-failure">{{ state.execution_summary.failure_count }}</span>
            {{ success_rate_display(state.execution_summary.success_rate, state.success_rate_green_threshold, state.success_rate_yellow_threshold) }}
        </td>
        <td>{{ state.execution_summary.avg_duration_seconds | format_duration }} avg</td>
        <td>
            <span title="Total input tokens">{{ "{:,}".format(state.execution_summary.total_input_tokens) }}</span><span class="text-muted">&darr;</span>
            /
            <span title="Total output tokens">{{ "{:,}".format(state.execution_summary.total_output_tokens) }}</span><span class="text-muted">&uarr;</span>
        </td>
        <td>${{ "%.4f" | format(state.execution_summary.total_cost_usd) }}</td>
        <td></td>
    </tr>
    </tfoot>
</table>
{% else %}
<p class="text-muted">No recent executions</p>
{% endif %}
