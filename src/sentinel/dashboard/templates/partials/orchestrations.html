{% if projects %}
<div class="nested-accordion">
    {% for project in projects %}
    <div class="nested-accordion-item">
        <div class="nested-accordion-header" onclick="toggleNestedAccordion(this)">
            <span class="collapse-icon">&#9654;</span>
            <strong>{{ project.identifier }}</strong>
            <span class="badge ml-2">{{ project.count }} orchestration{% if project.count != 1 %}s{% endif %}</span>
            <div class="bulk-toggle-buttons">
                <button class="btn-sm btn-success"
                        hx-post="/api/orchestrations/bulk-toggle"
                        hx-vals='js:{"source": "{{ source_type }}", "identifier": encodeURIComponent("{{ project.identifier }}"), "enabled": true}'
                        hx-swap="none"
                        hx-confirm="Enable all orchestrations in {{ project.identifier }}?"
                        hx-on::after-request="handleToggleResponse(event)"
                        onclick="event.stopPropagation()"
                        aria-label="Enable all orchestrations in {{ project.identifier }}">
                    Enable All
                </button>
                <button class="btn-sm btn-danger"
                        hx-post="/api/orchestrations/bulk-toggle"
                        hx-vals='js:{"source": "{{ source_type }}", "identifier": encodeURIComponent("{{ project.identifier }}"), "enabled": false}'
                        hx-swap="none"
                        hx-confirm="Disable all orchestrations in {{ project.identifier }}?"
                        hx-on::after-request="handleToggleResponse(event)"
                        onclick="event.stopPropagation()"
                        aria-label="Disable all orchestrations in {{ project.identifier }}">
                    Disable All
                </button>
            </div>
        </div>
        <div class="nested-accordion-content">
            <table class="nested-table">
                <tr>
                    <th>Name</th>
                    <th>Trigger Tags</th>
                    <th>Status</th>
                </tr>
                {% for orch in project.orchestrations %}
                <tr>
                    <td><strong>{{ orch.name }}</strong></td>
                    <td>
                        {% if orch.trigger_tags %}
                            {% for tag in orch.trigger_tags %}
                            <span class="tag">{{ tag }}</span>
                            {% endfor %}
                        {% else %}
                        <span style="color: var(--text-secondary);">-</span>
                        {% endif %}
                    </td>
                    <td>
                        <label class="toggle-switch">
                            <input type="checkbox"
                                   class="toggle-switch__input"
                                   {% if orch.enabled %}checked{% endif %}
                                   hx-post="/api/orchestrations/{{ orch.name }}/toggle"
                                   hx-vals='{"enabled": {{ "false" if orch.enabled else "true" }}}'
                                   hx-swap="none"
                                   hx-on::after-request="handleToggleResponse(event)">
                            <span class="toggle-switch__slider"></span>
                        </label>
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<p style="color: var(--text-secondary);">No {% if source_type == 'github' %}GitHub repositories{% else %}Jira projects{% endif %} with orchestrations</p>
{% endif %}
