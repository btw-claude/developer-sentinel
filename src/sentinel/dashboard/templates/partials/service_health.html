{# Security audit complete - no external links (target="_blank") in this template #}
{#
  XSS audit (DS-825): All dynamic values (svc.service_name, svc.last_error,
  svc.consecutive_failures, svc.probe_count) are rendered via {{ ... }} which
  is auto-escaped by the Jinja2 Environment configured with
  select_autoescape(["html", "xml"]) in app.py. This covers both element
  content and attribute contexts (e.g. the title="{{ svc.last_error }}"
  attribute). No |safe or {% autoescape false %} overrides are used here,
  so all output is escaped by default.
#}
{% from "macros.html" import humanize_duration, humanize_seconds_ago %}
{% if state.service_health %}
<table>
    <tr>
        <th>Service</th>
        <th>Status</th>
        <th>Failures</th>
        <th>Paused</th>
        <th>Last Error</th>
        <th>Probes</th>
        <th>Last Check</th>
    </tr>
    {% for svc in state.service_health %}
    <tr>
        <td>{{ svc.service_name }}</td>
        <td>
            {% if svc.available %}
            <span class="status-ok">&#9679; Available</span>
            {% else %}
            <span class="status-error">&#9679; Unavailable</span>
            {% endif %}
        </td>
        <td>{{ svc.consecutive_failures }}</td>
        <td>
            {% if svc.paused and svc.paused_since_seconds is not none %}
                {{ humanize_duration(svc.paused_since_seconds) }}
            {% else %}
            <span class="text-secondary">&mdash;</span>
            {% endif %}
        </td>
        <td>
            {% if svc.last_error %}
            <span class="status-error" title="{{ svc.last_error }}">{{ svc.last_error[:80] }}{% if svc.last_error|length > 80 %}...{% endif %}</span>
            {% else %}
            <span class="text-secondary">&mdash;</span>
            {% endif %}
        </td>
        <td>{{ svc.probe_count }}</td>
        <td>
            {% if svc.last_check_seconds_ago is not none %}
                {{ humanize_seconds_ago(svc.last_check_seconds_ago) }}
            {% else %}
            <span class="text-secondary">Never</span>
            {% endif %}
        </td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p class="text-secondary">No service health data available</p>
{% endif %}
