{% extends "base.html" %}

{% block title %}Dashboard - Developer Sentinel{% endblock %}

{% block content %}
<div id="status-section" hx-get="/partials/status" hx-trigger="every 5s" hx-swap="innerHTML">
    {% include "partials/status.html" %}
</div>

<div class="card">
    <h2>Quick Stats</h2>
    <div class="metric">
        <div class="metric-label">Orchestrations</div>
        <div class="metric-value">{{ state.orchestrations | length }}</div>
    </div>
    <div class="metric">
        <div class="metric-label">Active Versions</div>
        <div class="metric-value">{{ state.active_versions | length }}</div>
    </div>
    <div class="metric">
        <div class="metric-label">Pending Removal</div>
        <div class="metric-value">{{ state.pending_removal_versions | length }}</div>
    </div>
</div>

<div class="card">
    <h2>Configuration</h2>
    <table>
        <tr>
            <th>Setting</th>
            <th>Value</th>
        </tr>
        <tr>
            <td>Poll Interval</td>
            <td>{{ state.poll_interval }}s</td>
        </tr>
        <tr>
            <td>Max Concurrent Executions</td>
            <td>{{ state.max_concurrent_executions }}</td>
        </tr>
        <tr>
            <td>Max Issues Per Poll</td>
            <td>{{ state.max_issues_per_poll }}</td>
        </tr>
    </table>
</div>

<div class="card collapsible-section">
    <div class="collapsible-header"
         hx-get="/partials/system_status"
         hx-target="#system-status-content"
         hx-swap="innerHTML"
         hx-trigger="click"
         hx-on::after-request="toggleCollapsibleSection(this)">
        <h2>
            <span class="collapse-icon">&#9654;</span>
            System Status
        </h2>
    </div>
    <div id="system-status-content" class="collapsible-content"
         hx-get="/partials/system_status"
         hx-trigger="every 5s[isExpanded('system-status-content')]"
         hx-swap="innerHTML">
        <!-- Content loaded via HTMX when expanded, auto-refreshes every 5s -->
    </div>
</div>

<div class="card collapsible-section">
    <div class="collapsible-header"
         hx-get="/partials/running_steps"
         hx-target="#running-steps-content"
         hx-swap="innerHTML"
         hx-trigger="click"
         hx-on::after-request="toggleCollapsibleSection(this)">
        <h2>
            <span class="collapse-icon">&#9654;</span>
            Running Steps
            <span class="badge">{{ state.running_steps | length }}</span>
        </h2>
    </div>
    <div id="running-steps-content" class="collapsible-content"
         hx-get="/partials/running_steps"
         hx-trigger="every 1s[isExpanded('running-steps-content')]"
         hx-swap="innerHTML">
        <!-- Content loaded via HTMX when expanded, auto-refreshes every 1s -->
    </div>
</div>

<div class="card collapsible-section">
    <div class="collapsible-header"
         hx-get="/partials/issue_queue"
         hx-target="#issue-queue-content"
         hx-swap="innerHTML"
         hx-trigger="click"
         hx-on::after-request="toggleCollapsibleSection(this)">
        <h2>
            <span class="collapse-icon">&#9654;</span>
            Issue Queue
            <span class="badge">{{ state.issue_queue | length }}</span>
        </h2>
    </div>
    <div id="issue-queue-content" class="collapsible-content"
         hx-get="/partials/issue_queue"
         hx-trigger="every 5s[isExpanded('issue-queue-content')]"
         hx-swap="innerHTML">
        <!-- Content loaded via HTMX when expanded, auto-refreshes every 5s -->
    </div>
</div>

<div class="card collapsible-section">
    <div class="collapsible-header"
         hx-get="/partials/orchestrations?source=jira"
         hx-target="#jira-projects-content"
         hx-swap="innerHTML"
         hx-trigger="click"
         hx-on::after-request="toggleCollapsibleSection(this)">
        <h2>
            <span class="collapse-icon">&#9654;</span>
            Jira Projects
            <span class="badge">{{ state.jira_projects | length }}</span>
        </h2>
    </div>
    <div id="jira-projects-content" class="collapsible-content">
        <!-- Content loaded via HTMX when expanded -->
    </div>
</div>

<div class="card collapsible-section">
    <div class="collapsible-header"
         hx-get="/partials/orchestrations?source=github"
         hx-target="#github-repos-content"
         hx-swap="innerHTML"
         hx-trigger="click"
         hx-on::after-request="toggleCollapsibleSection(this)">
        <h2>
            <span class="collapse-icon">&#9654;</span>
            GitHub Repos
            <span class="badge">{{ state.github_repos | length }}</span>
        </h2>
    </div>
    <div id="github-repos-content" class="collapsible-content">
        <!-- Content loaded via HTMX when expanded -->
    </div>
</div>
{% endblock %}
