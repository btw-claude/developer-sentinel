# Developer Sentinel Environment Configuration
# Copy this file to .env and fill in your values

# =============================================================================
# RECOMMENDED - Jira REST API Configuration
# =============================================================================
# Configure these for direct REST API access, which is faster than SDK-based polling.
# All three must be set together. If not configured, falls back to SDK-based access.

# Jira instance URL (e.g., https://company.atlassian.net)
JIRA_BASE_URL=

# Email address for Jira authentication
JIRA_EMAIL=

# Jira API token (create one at https://id.atlassian.com/manage-profile/security/api-tokens)
JIRA_API_TOKEN=

# Custom field ID for epic links (default: customfield_10014)
# This varies by Jira instance - find yours via Settings > Issues > Custom Fields
# If set to empty string, classic epic link detection is disabled (epic_key will be None
# for issues without a next-gen parent epic). A warning is logged if the configured
# field is not found on any polled issues.
# JIRA_EPIC_LINK_FIELD=customfield_10014

# =============================================================================
# OPTIONAL - Sentinel Configuration
# =============================================================================
# Seconds between Jira polls (default: 60)
SENTINEL_POLL_INTERVAL=60

# Maximum issues to process per poll (default: 50)
SENTINEL_MAX_ISSUES=50

# Maximum concurrent orchestration executions (default: 1)
# Increase to process multiple issues in parallel
SENTINEL_MAX_CONCURRENT_EXECUTIONS=1

# Maximum consecutive eager polling iterations before forcing a sleep interval (default: 10)
# Prevents runaway polling if issues are being added faster than they can be processed
SENTINEL_MAX_EAGER_ITERATIONS=10

# Log level: DEBUG, INFO, WARNING, ERROR, CRITICAL (default: INFO)
SENTINEL_LOG_LEVEL=INFO

# Enable JSON log output: true, false (default: false)
SENTINEL_LOG_JSON=false

# Path to orchestration YAML files (default: ./orchestrations)
SENTINEL_ORCHESTRATIONS_DIR=./orchestrations

# Base directory for agent working directories (default: ./workdir)
# Each agent execution creates a unique subdirectory: {issue_key}_{timestamp}
SENTINEL_AGENT_WORKDIR=./workdir

# Base directory for agent execution logs (default: ./logs)
# Logs are stored per orchestration: {base_dir}/{orchestration_name}/{datetime}.log
SENTINEL_AGENT_LOGS_DIR=./logs

# Keep workdir after successful execution: true, false (default: false)
# When false (default), workdirs are cleaned up after successful agent executions.
# When true, workdirs are preserved for debugging or inspection.
# Failed executions always preserve workdirs regardless of this setting.
SENTINEL_KEEP_WORKDIR=false

# =============================================================================
# OPTIONAL - Dashboard Configuration
# =============================================================================
# Enable the web dashboard: true, false (default: false)
SENTINEL_DASHBOARD_ENABLED=false

# Port for the dashboard server (default: 8080)
SENTINEL_DASHBOARD_PORT=8080

# Host to bind the dashboard server (default: 127.0.0.1)
# Use 0.0.0.0 to allow external connections
SENTINEL_DASHBOARD_HOST=127.0.0.1

# =============================================================================
# OPTIONAL - Claude API Rate Limiting
# =============================================================================
# Rate limiting helps prevent runaway API costs and API throttling by controlling
# the frequency of Claude API calls using a token bucket algorithm.

# Enable/disable rate limiting for Claude API calls: true, false (default: true)
SENTINEL_CLAUDE_RATE_LIMIT_ENABLED=true

# Maximum requests per minute (default: 60)
# This provides short-term burst control
SENTINEL_CLAUDE_RATE_LIMIT_PER_MINUTE=60

# Maximum requests per hour (default: 1000)
# This provides long-term rate control for cost management
SENTINEL_CLAUDE_RATE_LIMIT_PER_HOUR=1000

# Strategy when rate limit is reached: queue, reject (default: queue)
# - queue: Wait for a permit (up to timeout), then proceed or fail
# - reject: Immediately fail with RateLimitExceededError
SENTINEL_CLAUDE_RATE_LIMIT_STRATEGY=queue

# Warning threshold as fraction of remaining capacity (default: 0.2)
# When available tokens fall below this fraction, warnings are logged
# Value must be between 0.0 and 1.0 (e.g., 0.2 = warn at 20% remaining)
SENTINEL_CLAUDE_RATE_LIMIT_WARNING_THRESHOLD=0.2

# =============================================================================
# OPTIONAL - Circuit Breaker Configuration
# =============================================================================
# Circuit breakers protect against cascading failures when external services
# (Jira, GitHub, Claude) are experiencing issues. When failures exceed a
# threshold, the circuit "opens" and fails fast, allowing services to recover.
#
# Circuit states:
# - CLOSED: Normal operation, requests pass through
# - OPEN: Service is failing, requests fail immediately without calling service
# - HALF_OPEN: Testing recovery, limited requests pass through

# Enable/disable circuit breakers for all services: true, false (default: true)
SENTINEL_CIRCUIT_BREAKER_ENABLED=true

# Number of consecutive failures before opening the circuit (default: 5)
SENTINEL_CIRCUIT_BREAKER_FAILURE_THRESHOLD=5

# Seconds to wait before attempting recovery after circuit opens (default: 30)
SENTINEL_CIRCUIT_BREAKER_RECOVERY_TIMEOUT=30

# Maximum calls to allow in half-open state for recovery testing (default: 3)
SENTINEL_CIRCUIT_BREAKER_HALF_OPEN_MAX_CALLS=3

# Service-specific overrides (optional)
# These override the global settings for specific services
# SENTINEL_JIRA_CIRCUIT_BREAKER_FAILURE_THRESHOLD=10
# SENTINEL_JIRA_CIRCUIT_BREAKER_RECOVERY_TIMEOUT=60
# SENTINEL_GITHUB_CIRCUIT_BREAKER_FAILURE_THRESHOLD=10
# SENTINEL_GITHUB_CIRCUIT_BREAKER_RECOVERY_TIMEOUT=60
# SENTINEL_CLAUDE_CIRCUIT_BREAKER_FAILURE_THRESHOLD=3
# SENTINEL_CLAUDE_CIRCUIT_BREAKER_RECOVERY_TIMEOUT=120

# =============================================================================
# OPTIONAL - Health Check Configuration
# =============================================================================
# Health check endpoints verify connectivity to external services (Jira, GitHub, Claude).
#
# Endpoints:
# - /health/live: Basic liveness check (service is running)
# - /health/ready: Readiness check with dependency verification
#
# Example response from /health/ready:
# {
#   "status": "healthy",
#   "timestamp": 1706472123.456,
#   "checks": {
#     "jira": {"status": "up", "latency_ms": 45},
#     "github": {"status": "up", "latency_ms": 32},
#     "claude": {"status": "up", "latency_ms": 120}
#   }
# }

# Enable/disable health checks: true, false (default: true)
SENTINEL_HEALTH_CHECK_ENABLED=true

# Timeout in seconds for individual health checks (default: 5.0)
# If a service check takes longer than this, it's marked as down
SENTINEL_HEALTH_CHECK_TIMEOUT=5.0

# =============================================================================
# OPTIONAL - Git Branch Configuration
# =============================================================================
# Default base branch for creating new feature branches (default: main)
# This is the global default used when orchestrations don't specify a base_branch.
# Each orchestration can override this via agent.github.base_branch.
# Common values: main, master, develop
#
# Branch names must follow git naming rules:
# - Cannot start with '-' or '.'
# - Cannot end with '.' or '/'
# - Cannot contain: space, ~, ^, :, ?, *, [, ], \, @{
# - Cannot contain consecutive '..' or '//'
SENTINEL_DEFAULT_BASE_BRANCH=main

# =============================================================================
# OPTIONAL - Codex CLI Configuration
# =============================================================================
# Configure these settings to use OpenAI's Codex CLI as an agent type.

# Path to the Codex CLI executable (default: empty, uses system PATH)
# Set this if the Codex CLI is not on your system PATH or you want to use a specific version
# SENTINEL_CODEX_PATH=/usr/local/bin/codex

# Default model to use with Codex CLI (default: empty, uses Codex CLI default)
# SENTINEL_CODEX_DEFAULT_MODEL=o4-mini
